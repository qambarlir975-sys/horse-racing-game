<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–û–ò 3D –ì–û–ù–ö–ò –õ–û–®–ê–î–ï–ô</title>
    <style>
        /* –í–°–ï –°–¢–ò–õ–ò –í –û–î–ù–û–ú –§–ê–ô–õ–ï */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            position: fixed;
        }
        
        #gameCanvas {
            display: block;
            background: linear-gradient(to bottom, #87CEEB 0%, #1E90FF 100%);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* –ò–ù–¢–ï–†–§–ï–ô–° */
        .ui-top {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #FFD700;
        }
        
        .money {
            color: #FFD700;
            font-size: 20px;
            font-weight: bold;
        }
        
        .energy {
            color: #00FF00;
            font-size: 20px;
            font-weight: bold;
        }
        
        .controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 15px;
        }
        
        .btn {
            padding: 20px 25px;
            font-size: 18px;
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            min-width: 120px;
            box-shadow: 0 5px 0 #CC0000;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .btn:active {
            transform: translateY(5px);
            box-shadow: 0 0px 0 #CC0000;
        }
        
        .btn-boost {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            box-shadow: 0 5px 0 #008000;
        }
        
        .btn-shop {
            background: linear-gradient(45deg, #3498db, #2980b9);
            box-shadow: 0 5px 0 #1B4F72;
        }
        
        .shop-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 20px;
            border: 3px solid #FFD700;
            display: none;
            width: 90%;
            max-width: 400px;
            z-index: 100;
        }
        
        .shop-items {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }
        
        .shop-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #3498db;
        }
        
        .shop-title {
            color: #FFD700;
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #FF416C;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
        }
        
        .notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 255, 0, 0.9);
            color: #000;
            padding: 20px;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            display: none;
            z-index: 1000;
            text-align: center;
        }
        
        /* –ú–ï–ù–Æ */
        .menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            border: 4px solid #FFD700;
            text-align: center;
            z-index: 1000;
        }
        
        .menu-title {
            color: #FFD700;
            font-size: 32px;
            margin-bottom: 30px;
            text-transform: uppercase;
        }
        
        .menu-btn {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 15px;
            font-size: 18px;
        }
        
        @media (max-width: 768px) {
            .btn {
                padding: 15px 20px;
                font-size: 16px;
                min-width: 100px;
            }
            
            .controls {
                gap: 10px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- –ö–ê–ù–í–ê–° –î–õ–Ø 3D -->
    <canvas id="gameCanvas"></canvas>
    
    <!-- –ò–ù–¢–ï–†–§–ï–ô–° -->
    <div class="ui-top">
        <div class="money">ü™ô <span id="moneyDisplay">1000</span></div>
        <div class="energy">‚ö° <span id="energyDisplay">100</span>/100</div>
        <div id="speedDisplay">üèá x<span id="speedValue">1.0</span></div>
    </div>
    
    <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï -->
    <div class="controls">
        <button class="btn" onclick="moveHorse(-1)">‚Üê –õ–ï–í–û</button>
        <button class="btn btn-boost" onclick="useBoost()" id="boostBtn">‚ö° –£–°–ö–û–†–ï–ù–ò–ï</button>
        <button class="btn" onclick="moveHorse(1)">–ü–†–ê–í–û ‚Üí</button>
    </div>
    
    <button class="btn btn-shop" onclick="openShop()" style="position: absolute; bottom: 100px; right: 20px;">üè¨ –ú–ê–ì–ê–ó–ò–ù</button>
    
    <!-- –ú–ê–ì–ê–ó–ò–ù -->
    <div class="shop-panel" id="shopPanel">
        <button class="close-btn" onclick="closeShop()">‚úï</button>
        <h2 class="shop-title">üè¨ –ú–ê–ì–ê–ó–ò–ù</h2>
        <div class="shop-items">
            <div class="shop-item">
                <h3>üêé –ù–û–í–ê–Ø –õ–û–®–ê–î–¨</h3>
                <p>–°–∫–æ—Ä–æ—Å—Ç—å: +0.5</p>
                <p>–¶–µ–Ω–∞: 500 ü™ô</p>
                <button class="btn" onclick="buyItem('horse')">–ö–£–ü–ò–¢–¨</button>
            </div>
            <div class="shop-item">
                <h3>‚ö° –ë–û–õ–¨–®–ï –≠–ù–ï–†–ì–ò–ò</h3>
                <p>+50 –º–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏–∏</p>
                <p>–¶–µ–Ω–∞: 300 ü™ô</p>
                <button class="btn" onclick="buyItem('energy')">–ö–£–ü–ò–¢–¨</button>
            </div>
            <div class="shop-item">
                <h3>üçé –≠–ù–ï–†–ì–ï–¢–ò–ö</h3>
                <p>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 30 —ç–Ω–µ—Ä–≥–∏–∏</p>
                <p>–¶–µ–Ω–∞: 100 ü™ô</p>
                <button class="btn" onclick="buyItem('apple')">–ö–£–ü–ò–¢–¨</button>
            </div>
        </div>
    </div>
    
    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø -->
    <div class="notification" id="notification"></div>
    
    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <div class="menu" id="mainMenu">
        <h1 class="menu-title">üèá 3D –ì–û–ù–ö–ò –õ–û–®–ê–î–ï–ô</h1>
        <button class="btn menu-btn" onclick="startGame()">‚ñ∂ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
        <button class="btn menu-btn btn-shop" onclick="openShop()">üè¨ –ú–ê–ì–ê–ó–ò–ù</button>
        <button class="btn menu-btn" onclick="showInstructions()">‚ùì –ö–ê–ö –ò–ì–†–ê–¢–¨</button>
    </div>

    <script>
        // === –ò–ì–†–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
        let money = 1000;
        let energy = 100;
        let maxEnergy = 100;
        let speed = 1.0;
        let gameStarted = false;
        let horsePosition = 0;
        let trackPosition = 0;
        let opponents = [];
        let coins = [];
        let lastTime = 0;
        
        // === –ö–ê–ù–í–ê–° –ò 3D –†–ï–ù–î–ï–†–ò–ù–ì ===
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // === 3D –ú–û–î–ï–õ–ò (–ø—Å–µ–≤–¥–æ-3D) ===
        function draw3DHorse(x, y, color, scale = 1, isPlayer = false) {
            // –¢–µ–ª–æ –ª–æ—à–∞–¥–∏
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.ellipse(x, y, 40 * scale, 20 * scale, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // –ì–æ–ª–æ–≤–∞
            ctx.beginPath();
            ctx.ellipse(x + 45 * scale, y - 10 * scale, 15 * scale, 12 * scale, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // –ù–æ–≥–∏
            const legY = y + 15 * scale;
            ctx.fillRect(x - 25 * scale, legY, 10 * scale, 25 * scale);
            ctx.fillRect(x - 5 * scale, legY, 10 * scale, 25 * scale);
            ctx.fillRect(x + 15 * scale, legY, 10 * scale, 25 * scale);
            ctx.fillRect(x + 35 * scale, legY, 10 * scale, 25 * scale);
            
            // –ñ–æ–∫–µ–π
            ctx.fillStyle = isPlayer ? '#FF416C' : '#3498db';
            ctx.beginPath();
            ctx.arc(x, y - 20 * scale, 12 * scale, 0, Math.PI * 2);
            ctx.fill();
            
            // –ò–º—è
            ctx.fillStyle = 'white';
            ctx.font = `${12 * scale}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText(isPlayer ? '–í–´' : '–°–û–ü–ï–†–ù–ò–ö', x, y - 40 * scale);
        }
        
        function draw3DTrack() {
            // –ù–µ–±–æ
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#1E90FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –î–æ—Ä–æ–≥–∞ (3D –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞)
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.moveTo(0, canvas.height);
            ctx.lineTo(canvas.width / 4, canvas.height * 0.6);
            ctx.lineTo(canvas.width * 3/4, canvas.height * 0.6);
            ctx.lineTo(canvas.width, canvas.height);
            ctx.closePath();
            ctx.fill();
            
            // –†–∞–∑–º–µ—Ç–∫–∞
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 3;
            ctx.setLineDash([20, 20]);
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, canvas.height * 0.6);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // –û–±–ª–∞–∫–∞
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            for(let i = 0; i < 3; i++) {
                const x = (Date.now() * 0.01 + i * 200) % (canvas.width + 200) - 100;
                const y = 100 + i * 50;
                ctx.beginPath();
                ctx.arc(x, y, 30, 0, Math.PI * 2);
                ctx.arc(x + 40, y, 40, 0, Math.PI * 2);
                ctx.arc(x + 80, y, 30, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function draw3DCoin(x, y) {
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x, y, 10, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#FFA500';
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#000';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('$', x, y + 4);
        }
        
        // === –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ===
        function startGame() {
            document.getElementById('mainMenu').style.display = 'none';
            gameStarted = true;
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤
            opponents = [];
            for(let i = 0; i < 3; i++) {
                opponents.push({
                    x: canvas.width / 2,
                    y: canvas.height * 0.7 + i * 80,
                    speed: 1 + Math.random() * 0.5,
                    color: `hsl(${i * 120}, 70%, 50%)`
                });
            }
            
            // –°–æ–∑–¥–∞–µ–º –º–æ–Ω–µ—Ç—ã
            coins = [];
            for(let i = 0; i < 10; i++) {
                coins.push({
                    x: Math.random() * canvas.width,
                    y: canvas.height * 0.7 + Math.random() * 200,
                    collected: false
                });
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameLoop();
        }
        
        function moveHorse(direction) {
            if (!gameStarted) return;
            horsePosition += direction * 5;
            horsePosition = Math.max(-100, Math.min(100, horsePosition));
        }
        
        function useBoost() {
            if (!gameStarted || energy < 20) return;
            
            energy -= 20;
            speed += 0.3;
            updateUI();
            
            setTimeout(() => {
                speed -= 0.3;
            }, 1000);
            
            showNotification('‚ö° –£–°–ö–û–†–ï–ù–ò–ï –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–û!');
        }
        
        function buyItem(type) {
            let cost = 0;
            
            switch(type) {
                case 'horse':
                    cost = 500;
                    if (money >= cost) {
                        money -= cost;
                        speed += 0.5;
                        showNotification('üêé –ù–û–í–ê–Ø –õ–û–®–ê–î–¨ –ö–£–ü–õ–ï–ù–ê! +0.5 –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏');
                    }
                    break;
                case 'energy':
                    cost = 300;
                    if (money >= cost) {
                        money -= cost;
                        maxEnergy += 50;
                        showNotification('‚ö° +50 –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏');
                    }
                    break;
                case 'apple':
                    cost = 100;
                    if (money >= cost) {
                        money -= cost;
                        energy = Math.min(energy + 30, maxEnergy);
                        showNotification('üçé –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
                    }
                    break;
            }
            
            if (money < cost) {
                showNotification('‚ùå –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –î–ï–ù–ï–ì!');
            }
            
            updateUI();
        }
        
        // === UI –§–£–ù–ö–¶–ò–ò ===
        function updateUI() {
            document.getElementById('moneyDisplay').textContent = money;
            document.getElementById('energyDisplay').textContent = energy;
            document.getElementById('speedValue').textContent = speed.toFixed(1);
            
            const boostBtn = document.getElementById('boostBtn');
            boostBtn.disabled = energy < 20;
            boostBtn.style.opacity = energy < 20 ? '0.5' : '1';
        }
        
        function showNotification(text) {
            const notif = document.getElementById('notification');
            notif.textContent = text;
            notif.style.display = 'block';
            notif.style.background = 'linear-gradient(45deg, #00b09b, #96c93d)';
            
            setTimeout(() => {
                notif.style.display = 'none';
            }, 2000);
        }
        
        function openShop() {
            document.getElementById('shopPanel').style.display = 'block';
        }
        
        function closeShop() {
            document.getElementById('shopPanel').style.display = 'none';
        }
        
        function showInstructions() {
            showNotification('‚Üê‚Üí –î–í–ò–ì–ê–¢–¨–°–Ø | ‚ö° –£–°–ö–û–†–ï–ù–ò–ï | üè¨ –ú–ê–ì–ê–ó–ò–ù');
        }
        
        // === –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ===
        function gameLoop(timestamp) {
            if (!lastTime) lastTime = timestamp;
            const deltaTime = (timestamp - lastTime) / 16;
            lastTime = timestamp;
            
            if (!gameStarted) {
                requestAnimationFrame(gameLoop);
                return;
            }
            
            // –û—á–∏—Å—Ç–∫–∞
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º 3D –º–∏—Ä
            draw3DTrack();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏ —Ä–∏—Å—É–µ–º –º–æ–Ω–µ—Ç—ã
            coins.forEach(coin => {
                if (!coin.collected) {
                    draw3DCoin(coin.x, coin.y);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∞
                    const dx = coin.x - (canvas.width / 2 + horsePosition);
                    const dy = coin.y - (canvas.height * 0.7);
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 30) {
                        coin.collected = true;
                        money += 50;
                        energy = Math.min(energy + 5, maxEnergy);
                        showNotification('ü™ô +50 –º–æ–Ω–µ—Ç!');
                        updateUI();
                    }
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤
            opponents.forEach((opp, index) => {
                opp.y -= opp.speed * speed;
                if (opp.y < canvas.height * 0.3) {
                    opp.y = canvas.height * 0.7 + 200;
                    opp.x = canvas.width / 2 + (Math.random() - 0.5) * 100;
                }
                
                draw3DHorse(opp.x, opp.y, opp.color, 0.8);
            });
            
            // –†–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞
            const playerX = canvas.width / 2 + horsePosition;
            const playerY = canvas.height * 0.7;
            draw3DHorse(playerX, playerY, '#8B4513', 1, true);
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
            if (energy < maxEnergy) {
                energy += 0.1;
                updateUI();
            }
            
            // –ê–≤—Ç–æ–¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥
            trackPosition += speed * 2;
            
            requestAnimationFrame(gameLoop);
        }
        
        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        updateUI();
        document.getElementById('mainMenu').style.display = 'block';
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        requestAnimationFrame(gameLoop);
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–∫–ª–æ–Ω–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', (e) => {
                if (!gameStarted) return;
                const tilt = e.gamma; // -90 to 90 degrees
                if (tilt) {
                    horsePosition = (tilt / 90) * 50;
                    horsePosition = Math.max(-100, Math.min(100, horsePosition));
                }
            });
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å–∞–Ω–∏—è–º–∏
        canvas.addEventListener('touchstart', (e) => {
            if (!gameStarted) return;
            const touchX = e.touches[0].clientX;
            const halfWidth = canvas.width / 2;
            
            if (touchX < halfWidth) {
                moveHorse(-1);
            } else {
                moveHorse(1);
            }
        });
    </script>
</body>
  </html>
